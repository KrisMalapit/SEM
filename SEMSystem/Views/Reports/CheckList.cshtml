


<style>
    #tbl input {
        border-color: #ccc;
        font-weight: 400;
        font-size: 14px;
    }
   
</style>
<div class="col-lg-12">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <h3>Filter By</h3>
            <div class="row form-group">
                <div class="col-md-3 row">
                    <label class="col-md-2" style="padding-top:5px;">Area</label>
                    <div class="col-md-10">
                        <select id="cmbType" name="AreaId" class="form-control" asp-items="ViewBag.AreaId"></select>
                    </div>
                </div>
                <div class="col-md-3 row">
                    <label class="col-md-2" style="padding-top:5px;">Equipment</label>
                    <div class="col-md-10">
                        <select id="cmbEquipment" name="EquipmentId" class="form-control" asp-items="ViewBag.EquipmentId"></select>
                    </div>
                </div>
                <div id="btnFilter" style="float:right;">
                    <button id="btnPrint" class="btn btn-info"><i class="fa fa-print"></i>&nbsp;Print</button>
                    <button id="btnExport" class="btn btn-primary"><i class="fa fa-file-excel-o"></i>&nbsp;Excel</button>
                </div>
             
            </div>
            <div class="row form-group">
                <div class="col-md-3 row">
                    <label class="col-md-2" style="padding-top:5px;">Date</label>
                    <div  style="background: #fff; cursor: pointer; padding: 5px 10px 0px 10px ;margin-left:15px; border: 1px solid #ccc; float: right">
                        <i class="fa fa-calendar"></i>&nbsp;
                        <span></span>  <input id="reportrange" type="text" name="daterange" style="border:none;" />
                    </div>
                </div>
            </div>





                @*FE*@
                <hr />
                <table id="tbl" class="table table-striped table-no-bordered table-hover dataTable" style="width: 100%!important">

                    <thead>

                        <tr>
                            <th>Location</th>
                            <th>Code</th>
                            <th>Items</th>
                            <th>Serial No</th>
                            <th>Equipment Type</th>
                            <th>Date Purchased</th>
                            <th>Expiration Date</th>
                            <th>Status</th>
                        </tr>

                    </thead>

                </table>


                <br />
                <br />
            </div>
    </div>
</div>
<script>

    var sdate = "";
    var edate = "";
    $from = ""
        $to = "";
     //printReport
    function print() {
        $from = moment().subtract(0, 'days').format('MM/DD/YYYY');
        $to = moment().subtract(0, 'days').format('MM/DD/YYYY');
        $refid = $("#cmbType"), val();

        window.open('@Url.Action("printReport", "Reports")?ReferenceId=' + $refid + '&fromDate=' + $from + '&toDate=' + $to + '&rptType=PDF' + '&Report=rptItemHistory');
    }
    $(function () {

        var start = moment().subtract(0, 'days');
        var end = moment();

        function cb(start, end) {
            $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            sdate = start;
            edate = end;
        }
        $('#reportrange').daterangepicker({
            opens: 'left'
        }, cb);
        cb(start, end);

     

    })
    $(function () {
        loadDatatable();

    })

    $("#cmbType").change(function () {
        loadDatatable();
    })





    function loadDatatable() {
        $type = $("#cmbType").val();


        if ($.fn.DataTable.isDataTable('#tbl')) {
            $('#tbl').DataTable().destroy();
        }

        $("#tbl").DataTable({


            "searching": true,
            "fixedHeader": true,


            "ajax": {
                "url": "@Url.Action("getDataItemInventory")?AreaId=" + $type,
                "type": "POST",
                "datatype": "json",

                "failure": function (result) {

                    toastr["error"](result.sEcho)
                    toastr.options = {
                        "closeButton": true,
                        "showDuration": "3000",
                    }
                }

            },





            "columns": [


                { "data": "location", "name": "Location", "autoWidth": true },
                { "data": "code", "name": "Location", "autoWidth": true },
                { "data": "itemName", "name": "ItemName", "autoWidth": true },
                { "data": "serialNo", "name": "SerialNo", "autoWidth": true },
                { "data": "equipmentType", "name": "EquipmentType", "autoWidth": true },

                {
                    data: "datePurchased",
                    name: "DatePurchased",
                    render: function (data, type, row) {

                        if (moment(data).format("MM-DD-YYYY") == '01-01-0001') {
                            return"";
                        } else {
                            return moment(data).format("MM-DD-YYYY");
                        }

                    }
                },
                {

                    name: "ExpirationDate",
                    render: function (data, type, row) {

                      //  var newDate = new Date(row.datePurchased.setMonth(row.datePurchased.getMonth() + 8));
                        var d = new Date(row.datePurchased);
                        var newDate = new Date(d.setMonth(d.getMonth() + row.warranty));


                        if (moment(newDate).format("MM-DD-YYYY") == '01-01-0001') {
                            return "";
                        } else {
                            return moment(newDate).format("MM-DD-YYYY");
                        }

                        //return moment(newDate).format("MM-DD-YYYY") ;
                    }
                },
                { "data": "itemStatus", "name": "ItemStatus", "autoWidth": true },
            ],

        });



    }
     $("#btnPrint").click(function () {

         
   

         $refid = $("#cmbType").val();
         $from = sdate.format('MM/DD/YYYY');
         $to = edate.format('MM/DD/YYYY');
         $equipment = $("#cmbEquipment").val();
         console.log('ref ' + $refid);
         console.log('from ' + $from);
         console.log('to ' + $to);
         console.log('equipment ' + $equipment);
         return false;
         window.open('@Url.Action("printReport", "Reports")?ReferenceId=' + $refid + '&fromDate=' + $from + '&toDate=' + $to + '&rptType=PDF' + '&Report=rptCheckList' + '&Equipment=' + $equipment);
        

    })
    $("#btnExport").click(function () {

       window.open('@Url.Action("DownloadExcelDocument", "Reports")?sqlCommand=' + sqlCommand + '&Report=rptFinalPrice' + '&strStart=' + $from + '&end=' + $to);
       // window.open('@Url.Action("DownloadExcelDocumentEPP", "Reports")?sqlCommand=' + sqlCommand + '&Report=rptFinalPrice' + '&strStart=' + $from + '&end=' + $to);

    })

</script>

