@model SEMSystem.Models.FireHydrantHeader


<style>
    /*table input {
        border-color: #e9ecef;
    }*/
</style>
<div class="col-lg-12">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <h2>Fire Extinguisher</h2>
            <div class="row">
                <label class="col-md-2 col-form-label" style="padding-top:5px;"> Area</label>


                <div class="col-md-4">
                 
                     @*  <select id="AreaId" name="AreaId" class="form-control" asp-items="@ViewBag.AreaId" disabled></select>*@
                    <input id="AreaId" name="AreaId" class="form-control" disabled value="@ViewBag.Area" />

                </div>


                <label class="col-md-2 col-form-label" style="padding-top:5px;"> Date</label>
                <div class="col-md-4">
                    <input id="Date" name="Date" class="form-control" disabled value="@ViewBag.CreatedAt" />
                </div>
            </div>
            <br />
            <div class="row">
                <label class="col-md-2 col-form-label" style="padding-top:5px;"> Location</label>
                <div class="col-md-4">
                  
                   
                        @*<select id="LocationId" name="LocationId" class="form-control" asp-items="ViewBag.LocationId" disabled></select>*@
                    <input id="LocationId" name="LocationId" class="form-control" disabled value="@ViewBag.Location" />

                </div>
                <label class="col-md-2 col-form-label" style="padding-top:5px;"> Plant</label>
                <div class="col-md-4">
                    <input id="Plant" name="Plant" class="form-control" disabled value="@ViewBag.Company"/>

                </div>
            </div>
            <br />

            <table id="tbl" class="table table-striped table-no-bordered table-hover dataTable" style="width: 100%!important">

                <thead>
                    <tr>
                        <th>ID</th>
                        <th width="20%">Item</th>
                        <th width="15%">Code</th>
                        <th width="15%">Type</th>
                        <th>Capacity</th>
                        <th>Cylinder</th>
                        <th>Lever</th>
                        <th>Gauge</th>
                        <th>Safety Seal</th>
                        <th>Hose</th>
                        <th  width="25%">Remarks</th>

                    </tr>

                </thead>

            </table>
            <p>

                <a href="#" onclick="saveFireHydrantData();">
                    <i class="fa fa-check"></i>
                    <span class="email-text">&nbsp;Save</span>
                </a>

                <text> |&nbsp; </text>





                <a href="#" onclick="print('@ViewBag.ID','rptFireHydrant');">
                    <i class="fa fa-print"></i>
                    <span class="print">&nbsp;Print</span>
                </a>





            </p>
            <a asp-action="Index">Back to List</a>
        </div>
           
        </div>
</div>


<script>
        $(function () {
           
            console.log(' @ViewBag.ID ');
                loadDatatableEdit();

        })
        
        $("input[type=text]").keyup(function () {
            $(this).val($(this).val().toUpperCase());
        });
        
        function loadDatatableEdit() {

        var data = [];

         $.ajax({
                        url: "@Url.Action("getDataDetails")"
                            , method: "POST"
                            , dataType: 'json'
                            , data: { id: @ViewBag.ID }
                            , success: function (responsedata) {
                                console.log(responsedata);
                                if (responsedata.status == "success") {

                                    if (responsedata.data[0].documentStatus === "Approved") {
                                        disableProp = "disabled= 'disabled'"
                                    } else {
                                        disableProp = ""
                                    }
                                    //$("#Plant").val(responsedata.data[0].companyName);

                                    for (var i = 0; i < responsedata.data.length; i++) {
                                        var $id = responsedata.data[i].id;

                                        $checkedValue = "";

                                        if (responsedata.data[i].glassCabinet == 1) {
                                            $checkedValue = 'checked';
                                        }

                                        var _glassCabinet =
                                            '<div class="form-check">' +
                                            '<label class="form-check-label">' +
                                            '<input class="form-check-input" type = "checkbox" value = "" ' + disableProp +' name = "GlassCabinet" ' + $checkedValue + '>' +
                                            '<span class="form-check-sign"><span class="check"></span></span>' +
                                            '</label>' +
                                            '</div>';

                                        $checkedValue = "";
                                        if (responsedata.data[i].hanger == 1) {
                                            $checkedValue = 'checked';
                                        }

                                        var _hanger = '<div class="form-check">' +
                                            '<label class="form-check-label">' +
                                            '<input class="form-check-input" type="checkbox" ' + disableProp +' value="" name="Hanger" ' + $checkedValue + '>' +
                                            '<span class="form-check-sign"><span class="check"></span></span>' +
                                            '</label>' +
                                            '</div>';

                                        $checkedValue = "";
                                        if (responsedata.data[i].hose15 == 1) {
                                            $checkedValue = 'checked';
                                        }

                                        var _hose15 = '<div class="form-check">' +
                                            '<label class="form-check-label">' +
                                            '<input class="form-check-input" type="checkbox" value="" ' + disableProp +' name="Hose15" ' + $checkedValue + '>' +
                                            '<span class="form-check-sign"><span class="check"></span></span>' +
                                            '</label>' +
                                            '</div>';

                                        $checkedValue = "";
                                        if (responsedata.data[i].nozzle15 == 1) {
                                            $checkedValue = 'checked';
                                        }

                                        var _nozzle15 =
                                            '<div class="form-check">' +
                                            '<label class="form-check-label">' +
                                            '<input class="form-check-input" type = "checkbox" value = "" ' + disableProp +' name = "Nozzle15" ' + $checkedValue + '>' +
                                            '<span class="form-check-sign"><span class="check"></span></span>' +
                                            '</label>' +
                                            '</div>';

                                        $checkedValue = "";
                                        if (responsedata.data[i].hose25 == 1) {
                                            $checkedValue = 'checked';
                                        }

                                        var _hose25 = '<div class="form-check">' +
                                            '<label class="form-check-label">' +
                                            '<input class="form-check-input" type="checkbox" value="" ' + disableProp +' name="Hose25" ' + $checkedValue + '>' +
                                            '<span class="form-check-sign"><span class="check"></span></span>' +
                                            '</label>' +
                                            '</div>';

                                        $checkedValue = "";
                                        if (responsedata.data[i].nozzle25 == 1) {
                                            $checkedValue = 'checked';
                                        }

                                        var _nozzle25 = '<div class="form-check">' +
                                            '<label class="form-check-label">' +
                                            '<input class="form-check-input" type="checkbox" value="" ' + disableProp +'  name="Nozzle25" ' + $checkedValue + '>' +
                                            '<span class="form-check-sign"><span class="check"></span></span>' +
                                            '</label>' +
                                            '</div>';

                                        $checkedValue = "";
                                        if (responsedata.data[i].specialTools == 1) {
                                            $checkedValue = 'checked';
                                        }

                                        var _specialTools = '<div class="form-check">' +
                                            '<label class="form-check-label">' +
                                            '<input class="form-check-input" type="checkbox" value="" ' + disableProp +' name="SpecialTools" ' + $checkedValue + '>' +
                                            '<span class="form-check-sign"><span class="check"></span></span>' +
                                            '</label>' +
                                            '</div>';

                                        var _rem = responsedata.data[i].remarks === null ? "" : responsedata.data[i].remarks;
                                        var _remarks = "<input " + disableProp + " class='form-control' style='width:100%' onfocus='this.select();' value='" + _rem + "'>";


                                        data.push([
                                            responsedata.data[i].itemId
                                            , responsedata.data[i].itemName
                                            , responsedata.data[i].code

                                            , _glassCabinet
                                            , _hanger
                                            , _hose15
                                            , _nozzle15
                                            , _hose25
                                            , _nozzle25
                                            , _specialTools

                                            , _remarks
                                        ]);

                                    }
                                    if ($.fn.DataTable.isDataTable('#tbl')) {
                                        $('#tbl').DataTable().destroy();
                                    }
                                    $('#tbl').DataTable({
                                        "data": data,
                                        "responsive": true,
                                        "lengthMenu": [[50, 100, -1], [50, 100, "All"]],
                                        //"columnDefs": [
                                        //    {
                                        //        visible: false,
                                        //        targets: [0]
                                        //    },
                                        //],
                                    });
                                } else {
                                    


                                        if ($.fn.DataTable.isDataTable('#tbl')) {
                                            $('#tbl').DataTable().destroy();
                                        }
                                        $('#tbl').DataTable({
                                            "data": data,
                                            "responsive": true,
                                            "lengthMenu": [[50, 100, -1], [50, 100, "All"]],
                                            //"columnDefs": [
                                            //    {
                                            //        visible: false,
                                            //        targets: [0]
                                            //    },
                                            //],
                                        });

                                   

                                }

                            }
            });






        }
    function saveFireHydrantData  () {


            var items = [];
            $("#tbl tbody tr").each(function () {
                //console.log($(this).closest('tr').find('input:checkbox')[0].checked)

                     var obj = {
                         ItemId: $(this).find("td:eq(0)").text(),
                         Cylinder: $(this).find('input:checkbox')[0].checked,
                         Lever: $(this).find('input:checkbox')[1].checked,
                         Gauge: $(this).find('input:checkbox')[2].checked,
                         SafetySeal: $(this).find('input:checkbox')[3].checked,
                         Hose: $(this).find('input:checkbox')[4].checked,
                         Remarks: $(this).find("td:eq(10)").find("input").val(),
                         AreaId: $("#AreaId").val(),
                         ID: @ViewBag.ID

                    }
                    items.push(obj)


                });




            $.ajax({
                url: "@Url.Action("EditData")"
                , type: "POST"
                , dataType: "json"
                , data: { item: items }
                     , success: function (responsedata) {

                        if (responsedata.status == "success") {

                            toastr["success"]("Item saved!", "<b>Success</b> ")


                        } else {

                            toastr["error"](responsedata.message)
                            toastr.options = {
                                "closeButton": true,
                                "showDuration": "3000",
                            }
                        }
                    }
                })


    }
     function print($refid,$rpt) {
        window.open('@Url.Action("printReport", "Reports")?ReferenceId=' + $refid+ '&Report=' + $rpt + '&rptType=PDF');
    }

</script>
