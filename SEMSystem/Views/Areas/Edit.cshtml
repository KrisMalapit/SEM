@model SEMSystem.Models.Area

@{
    ViewData["Title"] = "Edit";
}
<style>
    .error-input {
        border-color: hsl(0, 76%, 50%) !important;
    }

    table a {
        color: white !important;
    }
    .modal-lg{
        width : 80%!important;
    }
</style>


<div class="modal inmodal in " id="modalItem" tabindex="-1" aria-hidden="true" data-focus-on="input:first">
    <div class="modal-dialog modal-lg">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">

                <h4 class="modal-title" id="modalTitle"></h4>
                <small class="font-bold">Loaded in this location</small>
            </div>
            <div class="modal-body">
                <input id="ItemType" type="hidden" />
                <input id="ReferenceId" type="hidden" />
                <input id="LocationName" type="hidden" />
                <div class="form-group">

                    <form id="frm">
                        <table id="tblItems" class="table table-striped table-no-bordered table-hover dataTable" style="width: 100%!important">
                            <thead>
                                <tr>

                                    <th>Code</th>
                                    <th>Name </th>

                                    <th>Serial No</th>
                                    <th>Item Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                        </table>
                    </form>



                </div>

                <button id="btnAddItem" class="btn btn-success" data-toggle="modal" href="#modalItemList">Add Item</button>
                <button type="button" class="btn btn-white" id="closeItem">Close</button>

            </div>
        </div>

    </div>
</div>

<div class="modal inmodal in " id="modalItemList" tabindex="-1"  aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">

                <h4 class="modal-title" id="modalTitleItems"></h4>
                <small class="font-bold">List of Items</small>
            </div>
           
            <div class="modal-body">
                <input id="ItemType" type="hidden" />
                <input id="ReferenceId" type="hidden" />
                <div class="form-group">

                    <form id="frm">
                        <table id="tblItemsList" class="table table-striped table-no-bordered table-hover dataTable" style="width: 100%!important">
                            <thead>
                                <tr>
                                    <th><input name="select_all" value="0" id="tblItemsList-select-all" type="checkbox" /></th>
                                    <th>Code</th>
                                    <th>Name</th>
                                    <th>Serial No</th>
                                    <th>Equipment Type</th>
                                    <th>Item Status</th>

                                </tr>
                            </thead>
                        </table>
                    </form>



                </div>

                <button type="button" class="btn btn-primary" onclick="proceed();" id="btnApprove">Add selected items</button>
                <button type="button" class="btn btn-white" id="closeItemList">Close</button>

            </div>
        </div>

    </div>
</div>




<div class="col-lg-12">
  
       

            <form asp-action="Edit">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input type="hidden" asp-for="ID" />
               

                <div class="panel panel-success">
                    <div class="panel-heading">
                        Area Information
                    </div>
                    <div class="panel-body">
                        <div class="row form-group">

                            <label class="col-md-2 col-form-label" style="padding-top:5px;" asp-for="Code"></label>
                            <div class="col-md-4">
                                <input asp-for="Code" class="form-control" />
                                <span asp-validation-for="Code" class="text-danger"></span>
                            </div>
                            <label class="col-md-2 col-form-label" style="padding-top:5px;" asp-for="Name"></label>
                            <div class="col-md-4">
                                <input asp-for="Name" class="form-control" />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>

                        </div>
                        <div class="row form-group">
                            <label class="col-md-2 col-form-label" style="padding-top:5px;" asp-for="CompanyId"></label>
                            <div class="col-md-4">
                                <select asp-for="CompanyId" class="form-control" asp-items="ViewBag.CompanyId"></select>
                                <span asp-validation-for="CompanyId" class="text-danger"></span>
                            </div>

                        </div>
                        <div class="form-group">
                            <input type="submit" value="Save" class="btn btn-default" />
                        </div>
                    </div>
                </div>
            </form>
       

            <h3>  <i class="fa fa-location-arrow"></i>&nbsp; Equipments</h3>

            <form asp-action="Edit" id="frmLocation">
                @*Fire Extinguisher*@
                <div class="col-lg-12 parentDiv" id="divFE" style="padding:0px!important;">
                    <div class="ibox float-e-margins border-bottom">
                        <div class="ibox-title ">
                            <h5>Fire Extinguisher </h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-down"></i>
                                </a>


                            </div>
                        </div>
                        <div class="ibox-content" style="display:none;">
                            <div class="form-group">
                                <script id="FEtemplate" type="text/template">
                                    <td>
                                        <input value="0" type="hidden" name="detail_id[]" />
                                        <input class="form-control" type="text" placeholder="Location" name="location[]" required />
                                    </td>
                                    <td><input class="total form-control" type="text" placeholder="Code" name="code[]" required /></td>
                                    @*<td><input class="quantity form-control" type="text" placeholder="Type" name="type[]" required /></td>
                                    <td><input class="cost form-control" type="text" placeholder="Capacity" name="capacity[]" required /></td>*@
                                    <td>
                                        <a class="remFE btn btn-danger "><span title="Delete" class="glyphicon glyphicon-remove"></span></a>

                                    </td>
                                </script>
                                <table class="table table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th width="5%">#</th>
                                            <th>Location</th>
                                            <th width="10%">Code</th>
                                            @*<th width="15%">Type</th>
                                            <th width="10%">Capacity </th>*@
                                            <th width="10%">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="p_FE">
                                        <tr>
                                            <td>1</td>
                                            <td>
                                                <input type="hidden" name="detail_id[]" />
                                                <input class="form-control" type="text" placeholder="Location" name="location[]" required />
                                            </td>
                                            <td><input class="total form-control" type="text" placeholder="Code" name="code[]" required /></td>
                                            @*<td><input class="quantity form-control" type="text" placeholder="Type" name="type[]" required /></td>
                                            <td><input class="cost form-control" type="text" placeholder="Capacity" name="capacity[]" required /></td>*@
                                            <td>
                                                <button class="addFE btn btn-default" type="button"><i class="fa fa-plus"></i> </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <p>

                                <a href="#" onclick="saveLocation(this);">
                                    <i class="fa fa-check"></i>
                                    <span class="email-text">&nbsp;Save</span>
                                </a>



                            </p>



                        </div>
                    </div>
                </div>


                @*Emergency Lights*@
                <div class="col-lg-12 parentDiv" id="divEL" style="padding:0px!important;">
                    <div class="ibox float-e-margins border-bottom">
                        <div class="ibox-title ">
                            <h5>Emergency Lights <small></small></h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-down"></i>
                                </a>


                            </div>
                        </div>
                        <div class="ibox-content" style="display:none;">
                            <div class="form-group">
                                <script id="ELtemplate" type="text/template">
                                    <td>
                                        <input value="0" type="hidden" name="detail_id[]" />
                                        <input class="form-control" type="text" placeholder="Location" name="location[]" required />
                                    </td>
                                    <td><input class="total form-control" type="text" placeholder="Code" name="code[]" required /></td>
                                    <td>
                                        <a class="remEL btn btn-danger "><span title="Delete" class="glyphicon glyphicon-remove"></span></a>
                                    </td>
                                </script>
                                <table class="table table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th width="5%">#</th>
                                            <th>Location</th>
                                            <th width="40%">Code</th>
                                            <th width="7%">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="p_EL">
                                        <tr>
                                            <td>1</td>
                                            <td>
                                                <input type="hidden" name="detail_id[]" />
                                                <input class="form-control" type="text" placeholder="Location" name="location[]" required />
                                            </td>
                                            <td><input class="total form-control" type="text" placeholder="Code" name="code[]" required /></td>
                                            <td><button class="addEL btn btn-default" type="button"><i class="fa fa-plus"></i> </button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <p>
                                <a href="#" onclick="saveLocation(this);">
                                    <i class="fa fa-check"></i>
                                    <span class="email-text">&nbsp;Save</span>
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
                @*Fire Hydrant*@
                <div class="col-lg-12 parentDiv" id="divFH" style="padding:0px!important;">
                    <div class="ibox float-e-margins border-bottom">
                        <div class="ibox-title ">
                            <h5>Fire Hydrant <small></small></h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-down"></i>
                                </a>


                            </div>
                        </div>
                        <div class="ibox-content" style="display:none;">
                            <div class="form-group">
                                <script id="FHtemplate" type="text/template">
                                    <td>
                                        <input value="0" type="hidden" name="detail_id[]" />
                                        <input class="form-control" type="text" placeholder="Location" name="location[]" required />
                                    </td>
                                    <td><input class="total form-control" type="text" placeholder="Code" name="code[]" required /></td>
                                    <td>
                                        <a class="remFH btn btn-danger "><span title="Delete" class="glyphicon glyphicon-remove"></span></a>
                                    </td>
                                </script>
                                <table class="table table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th width="5%">#</th>
                                            <th>Location</th>
                                            <th width="40%">Code</th>
                                            <th width="7%">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="p_FH">
                                        <tr>
                                            <td>1</td>
                                            <td>
                                                <input type="hidden" name="detail_id[]" />
                                                <input class="form-control" type="text" placeholder="Location" name="location[]" required />
                                            </td>
                                            <td><input class="total form-control" type="text" placeholder="Code" name="code[]" required /></td>
                                            <td><button class="addFH btn btn-default" type="button"><i class="fa fa-plus"></i> </button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <p>
                                <a href="#" onclick="saveLocation(this);">
                                    <i class="fa fa-check"></i>
                                    <span class="email-text">&nbsp;Save</span>
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
                @*Inergen Tank*@
                <div class="col-lg-12 parentDiv" id="divIT" style="padding:0px!important;">
                    <div class="ibox float-e-margins border-bottom">
                        <div class="ibox-title ">
                            <h5>Inergen Tank <small></small></h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-down"></i>
                                </a>


                            </div>
                        </div>
                        <div class="ibox-content" style="display:none;">
                            <div class="form-group">
                                <script id="ITtemplate" type="text/template">
                                    @*<td> 
                                        <input class="total form-control" type="text" placeholder="Serial" name="serial[]" required />
                                    </td>*@
                                    @*<td>
                                        <input value="0" type="hidden" name="detail_id[]" />
                                        <input class="cost form-control" type="text" placeholder="Capacity" name="capacity[]" required />
                                    </td>*@
                                    <td>
                                <input value="0" type="hidden" name="detail_id[]" />
                                <input class="form-control" type="text" placeholder="Location" name="location[]" required />
                            </td>

                                    <td><input class="quantity form-control" type="text" placeholder="Area" name="area[]" required /></td>

                                    <td>
                                        <a class="remIT btn btn-danger "><span title="Delete" class="glyphicon glyphicon-remove"></span></a>
                                    </td>
                                </script>
                                <table class="table table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th width="5%">#</th>
                                            @*<th width="15%">Serial No</th>*@

                                            <th width="15%">Location </th>
                                            <th width="20%">Location of Cylinder</th>
                                            <th>Area of Extinguishing System</th>

                                            <th width="7%">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="p_IT">
                                        <tr>
                                            <td>1</td>
                                            @*<td>
                                                <input type="hidden" name="detail_id[]" />
                                                <input class="serial form-control" type="text" placeholder="Serial" name="serial[]" required />
                                            </td>

                                            <td><input class="cost form-control" type="text" placeholder="Capacity" name="capacity[]" required /></td>*@
                                            <td>
                                        <input type="hidden" name="detail_id[]" />
                                        <input class="form-control" type="text" placeholder="Location" name="location[]" required />
                                    </td>
                                            <td><input class="area form-control" type="text" placeholder="Area" name="area[]" required /></td>

                                            <td><button class="addIT btn btn-default" type="button"><i class="fa fa-plus"></i> </button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <p>

                                <a href="#" onclick="saveLocation(this);">
                                    <i class="fa fa-check"></i>
                                    <span class="email-text">&nbsp;Save</span>
                                </a>





                            </p>



                        </div>
                    </div>
                </div>

            </form>

            <a asp-action="Index">Back to List</a>


       
  
</div>

<script>
    var EquipmentType = "";
    var ReferenceId = "";

    $(function () {
        loadLocation(@Model.ID);
    })

    $("input[type=text]").keyup(function () {
        $(this).val($(this).val().toUpperCase());
    });

    $("#btnAddItem").click(function () {
        reloadItems();
        $("#modalItem").modal("hide");
    })

    //Fire Extinguisher
    var FEDiv = $('#p_FE');
    $(document).on('click', '.addFE', function () {
        var i = $('#p_FE tr').length + 1;
        var $tr = $('<tr>').append('<td>' + i + '</td>' + $('#FEtemplate').html());
        FEDiv.append($tr);
    })
    $(document).on('click', '.remFE', function () {
        var i = $('#p_FE tr').length;
        if (i > 1) {
            $(this).closest('tr').remove();
        }
        return false;
    });
    $(document).on('click', '.detailFE', function () {
        showItemModal("FE", $(this).attr('data-id'), $(this).attr('data-location'))
    });

    //End Fire Extinguisher


    //Emergency Light
    var ELDiv = $('#p_EL');
    $(document).on('click', '.addEL', function () {
        var i = $('#p_EL tr').length + 1;
        var $tr = $('<tr>').append('<td>' + i + '</td>' + $('#ELtemplate').html());
        ELDiv.append($tr);
    })

    $(document).on('click', '.remEL', function () {
        var i = $('#p_EL tr').length;
        if (i > 1) {
            $(this).closest('tr').remove();
        }
        return false;
    });
    $(document).on('click', '.detailEL', function () {
        showItemModal("EL", $(this).attr('data-id'), $(this).attr('data-location'))
    });
    //End Emergency Light

    //Fire Hydrant
    var FHDiv = $('#p_FH');
    $(document).on('click', '.addFH', function () {
        var i = $('#p_FH tr').length + 1;
        var $tr = $('<tr>').append('<td>' + i + '</td>' + $('#FHtemplate').html());
        FHDiv.append($tr);
    })

    $(document).on('click', '.remFH', function () {
        var i = $('#p_FH tr').length;
        if (i > 1) {
            $(this).closest('tr').remove();
        }
        return false;
    });
    $(document).on('click', '.detailFH', function () {
        showItemModal("FH", $(this).attr('data-id'), $(this).attr('data-location'))
    });
    //End Fire Hydrant


    //Inergen Tank
    var ITDiv = $('#p_IT');
    $(document).on('click', '.addIT', function () {
        var i = $('#p_IT tr').length + 1;
        var $tr = $('<tr>').append('<td>' + i + '</td>' + $('#ITtemplate').html());
        ITDiv.append($tr);
    })

    $(document).on('click', '.remIT', function () {
        var i = $('#p_IT tr').length;
        if (i > 1) {
            $(this).closest('tr').remove();
        }
        return false;
    });
    $(document).on('click', '.detailIT', function () {
        showItemModal("IT", $(this).attr('data-id'), $(this).attr('data-location'))
    });
    //End Inergen Tank


    function saveLocation($type) {
        var cnt = 0;
        var divLocation = $($type).closest('div .parentDiv').prop('id');
        $('form').find('#' + divLocation + ' input').each(function () {
            if ($(this).prop('required')) {
                if (!$(this).val()) {
                    cnt = 1;
                    $(this).addClass("error-input");
                } else {
                    $(this).removeClass("error-input");
                }
            }
        });

        if (cnt > 0) {
            toastr["error"]("Fill all required fields", "Error")
            toastr.options = {
                "closeButton": true,
                "showDuration": "3000",
            }
            return false;
        }



        var data = $("#" + divLocation + " :input").serializeArray();
        data.push({ name: 'Equipment', value: divLocation });
        data.push({ name: 'AreaId', value: @Model.ID });


       

        $.ajax({
            url: "@Url.Action("SaveLocation")"
            , method: "POST"
            , data: data
            , dataType: 'json'
             , success: function (responsedata) {

                if (responsedata.status == "success") {

                    toastr["success"]("Item saved!", "<b>Success</b> ")


                } else {

                    toastr["error"](responsedata.message)
                    toastr.options = {
                        "closeButton": true,
                        "showDuration": "3000",
                    }
                }
            }
        })


    }
    function loadLocation(id) {
        $.ajax({
            url: "@Url.Action("getDataLocation")"
            , method: "POST"
            , data: { AreaId : @Model.ID}
            , dataType: 'json'
             , success: function (responsedata) {
                 console.log(responsedata);
                 if (responsedata.status == "success") {

                     //fire extinguisher
                     $rowsfe = responsedata.locationfe.length
                     $('#p_FE > tr:nth-child(1)').remove();
                     if ($rowsfe === 0 ) {
                         $trr =
                             '<tr>' +
                             '<td>1</td>' +
                             '<td>' +
                             '<input value="0" type="hidden" name="detail_id[]" />' +
                             '<input class="form-control" type="text" placeholder="Location" name="location[]" required />' +
                             '</td >' +
                             '<td><input class="form-control" type="text" placeholder="Code" name="code[]" required /></td>' +
                             //'<td><input class="form-control" type="text" placeholder="Type" name="type[]" required /></td>' +
                             //'<td><input class="form-control" type="text" placeholder="Capacity" name="capacity[]" required /></td>' +
                             '<td><button class="addFE btn btn-default" type="button"><i class="fa fa-plus"></i> </button></td>' +
                             '</tr>'
                         var $tr = $('<tr>').append('<td>' + i + '</td>' + $trr);
                         FEDiv.append($tr);
                     } else {

                     }
                     for (var j = 0; j < $rowsfe; j++) {


                         var $trr = '';
                         if (j===0) {

                             $trr =
                                 '<tr>' +
                                 '<td>1</td>'+
                                 '<td>'+
                                 '<input value="' + responsedata.locationfe[j].id + '"  type="hidden" name="detail_id[]" />'+
                                 '<input class="form-control" type="text" placeholder="Location" name="location[]" value="' + responsedata.locationfe[j].location + '" required />'+
                                 '</td >'+
                                 '<td><input class="form-control" type="text" placeholder="Code" name="code[]" value="' + responsedata.locationfe[j].code + '"required /></td>'+
                                 //'<td><input class="form-control" type="text" placeholder="Type" name="type[]" value="' + responsedata.locationfe[j].type + '"required /></td>'+
                                 //'<td><input class="form-control" type="text" placeholder="Capacity" name="capacity[]" value="' + responsedata.locationfe[j].capacity + '" required /></td>'+
                                 '<td>' +
                                     '<div class="row">' +
                                         '<div class="col-md-12">' +
                                         '<button class="addFE btn btn-default " type="button"><i class="fa fa-plus"></i></button>&nbsp;' + 
                                         '<button class="detailFE btn btn-info " type="button" data-location="' + responsedata.locationfe[j].location + '" data-id=' + responsedata.locationfe[j].id +' ><i class="fa fa-list"></i></button>' +
                                         '</div>' +
                                     '</div>' +
                                 '</td > ' +
                                 '</tr>'


                         } else {
                             var i = $('#p_FE tr').length + 1;

                             $trr =


                                 '<td>' +
                                 '<input value="' + responsedata.locationfe[j].id + '"  type="hidden" name="detail_id[]" />' +
                                 '<input class="form-control" type="text" placeholder="Location" name="location[]" value="' + responsedata.locationfe[j].location + '" required />' +
                                 '</td >' +
                                 '<td><input class="form-control" type="text" placeholder="Code" name="code[]" value="' + responsedata.locationfe[j].code + '"required /></td>' +
                                 //'<td><input class="form-control" type="text" placeholder="Type" name="type[]" value="' + responsedata.locationfe[j].type + '"required /></td>' +
                                 //'<td><input class="form-control" type="text" placeholder="Capacity" name="capacity[]" value="' + responsedata.locationfe[j].capacity + '" required /></td>' +
                             '<td>' +
                             '<a class="remFE btn btn-danger"><span title="Delete" class="glyphicon glyphicon-remove"></span></a>&nbsp;' +
                             '<button class="detailFE btn btn-info " type="button" data-location="' + responsedata.locationfe[j].location +'" data-id=' + responsedata.locationfe[j].id +'><i class="fa fa-list"></i></button>' +
                             '</td>'

                         }
                         var $tr = $('<tr>').append('<td>' + i + '</td>' + $trr);
                         FEDiv.append($tr);



                     }

                     //emergency lights

                     $rowsel = responsedata.locationel.length
                     $('#p_EL > tr:nth-child(1)').remove();
                     if ($rowsel === 0) {
                         $trr =
                             '<tr>' +
                             '<td>1</td>' +
                             '<td>' +
                             '<input value="0"  type="hidden" name="detail_id[]" />' +
                             '<input class="form-control" type="text" placeholder="Location" name="location[]" required />' +
                             '</td >' +
                             '<td><input class="form-control" type="text" placeholder="Code" name="code[]" required /></td>' +

                             '<td><button class="addEL btn btn-default" type="button"><i class="fa fa-plus"></i> </button></td>' +
                             '</tr>'
                         var $tr = $('<tr>').append('<td>' + i + '</td>' + $trr);
                         ELDiv.append($tr);
                     } else {

                     }
                     for (var j = 0; j < $rowsel; j++) {


                         var $trr = '';
                         if (j === 0) {

                             $trr =
                                 '<tr>' +
                                 '<td>1</td>' +
                                 '<td>' +
                                 '<input value="' + responsedata.locationel[j].id + '"  type="hidden" name="detail_id[]" />' +
                                 '<input class="form-control" type="text" placeholder="Location" name="location[]" value="' + responsedata.locationel[j].location + '" required />' +
                                 '</td >' +
                                 '<td><input class="form-control" type="text" placeholder="Code" name="code[]" value="' + responsedata.locationel[j].code + '"required /></td>' +

                             '<td>' +
                             '<div class="row">' +
                             '<div class="col-md-12">' +
                             '<button class="addEL btn btn-default " type="button"><i class="fa fa-plus"></i></button>&nbsp;' +
                             '<button class="detailEL btn btn-info " type="button" data-location="' + responsedata.locationel[j].location +'" data-id=' + responsedata.locationel[j].id + ' ><i class="fa fa-list"></i></button>' +
                             '</div>' +
                             '</div>' +
                             '</td > ' +
                                 '</tr>'


                         } else {
                             var i = $('#p_EL tr').length + 1;

                             $trr =
                                 '<td>' +
                                 '<input value="' + responsedata.locationel[j].id + '"  type="hidden" name="detail_id[]" />' +
                                 '<input class="form-control" type="text" placeholder="Location" name="location[]" value="' + responsedata.locationel[j].location + '" required />' +
                                 '</td >' +
                                 '<td><input class="form-control" type="text" placeholder="Code" name="code[]" value="' + responsedata.locationel[j].code + '"required /></td>' +

                             '<td>' +
                             '<a class="remEL btn btn-danger"><span title="Delete" class="glyphicon glyphicon-remove"></span></a>&nbsp;' +
                             '<button class="detailEL btn btn-info " type="button" data-location="' + responsedata.locationel[j].location +'" data-id=' + responsedata.locationel[j].id + '><i class="fa fa-list"></i></button>' +
                             '</td>'
                         }
                         var $tr = $('<tr>').append('<td>' + i + '</td>' + $trr);
                         ELDiv.append($tr);



                     }

                     //Fire Hydrant
                    
                     $rowsfh = responsedata.locationfh.length
                     $('#p_FH > tr:nth-child(1)').remove();
                     if ($rowsfh === 0) {
                         $trr =
                             '<tr>' +
                             '<td>1</td>' +
                             '<td>' +
                             '<input value="0"  type="hidden" name="detail_id[]" />' +
                             '<input class="form-control" type="text" placeholder="Location" name="location[]" required />' +
                             '</td >' +
                             '<td><input class="form-control" type="text" placeholder="Code" name="code[]" required /></td>' +

                             '<td><button class="addFH btn btn-default" type="button"><i class="fa fa-plus"></i> </button></td>' +
                             '</tr>'
                         var $tr = $('<tr>').append('<td>' + i + '</td>' + $trr);
                         FHDiv.append($tr);
                     } else {

                     }
                     for (var j = 0; j < $rowsfh; j++) {
                        

                         var $trr = '';
                         if (j === 0) {

                             $trr =
                                 '<tr>' +
                                 '<td>1</td>' +
                                 '<td>' +
                                 '<input value="' + responsedata.locationfh[j].id + '"  type="hidden" name="detail_id[]" />' +
                                 '<input class="form-control" type="text" placeholder="Location" name="location[]" value="' + responsedata.locationfh[j].location + '" required />' +
                                 '</td >' +
                                 '<td><input class="form-control" type="text" placeholder="Code" name="code[]" value="' + responsedata.locationfh[j].code + '"required /></td>' +

                             '<td>' +
                             '<div class="row">' +
                             '<div class="col-md-12">' +
                             '<button class="addFH btn btn-default " type="button"><i class="fa fa-plus"></i></button>&nbsp;' +
                             '<button class="detailFH btn btn-info " type="button" data-location="' + responsedata.locationfh[j].location +'" data-id=' + responsedata.locationfh[j].id + ' ><i class="fa fa-list"></i></button>' +
                             '</div>' +
                             '</div>' +
                             '</td > ' +
                                 '</tr>'


                         } else {
                             var i = $('#p_FH tr').length + 1;

                             $trr =
                                 '<td>' +
                                 '<input value="' + responsedata.locationfh[j].id + '"  type="hidden" name="detail_id[]" />' +
                                 '<input class="form-control" type="text" placeholder="Location" name="location[]" value="' + responsedata.locationfh[j].location + '" required />' +
                                 '</td >' +
                                 '<td><input class="form-control" type="text" placeholder="Code" name="code[]" value="' + responsedata.locationfh[j].code + '"required /></td>' +
                                 '<td>' +
                                 '<a class="remFH btn btn-danger"><span title="Delete" class="glyphicon glyphicon-remove"></span></a>&nbsp;' +
                                 '<button class="detailFH btn btn-info " type="button"  data-location="' + responsedata.locationfh[j].location +'" data-id=' + responsedata.locationfh[j].id + '><i class="fa fa-list"></i></button>' +
                                 '</td>'
                         }
                         
                         var $tr = $('<tr>').append('<td>' + i + '</td>' + $trr);
                        
                         FHDiv.append($tr);



                     }

                     


                     //Inergen Tank
                     $rowsit = responsedata.locationit.length
                     $('#p_IT > tr:nth-child(1)').remove();
                     if ($rowsit === 0) {
                        
                         $trr =
                             '<tr>' +
                         '<td>1</td>' +
                         '<td>' +
                         '<input value = "0"  type = "hidden" name = "detail_id[]" />' +
                         '<input class="form-control" type="text" placeholder="Location" name="location[]" required />' +
                         '</td> ' +
                             '<td>' +
                                
                                 '<input class="form-control" type="text" placeholder="Location of Cylinder" name="locationcylinder[]" required />' +
                            '</td> ' +
                             '<td>' + 
                                 '<input class="form-control" type="text" placeholder="Area of Extinguishing System" name="area[]" required />' +
                             '</td>' +
                             '<td><button class="addIT btn btn-default" type="button"><i class="fa fa-plus"></i> </button></td>' +
                             '</tr>'
                         var $tr = $('<tr>').append('<td>' + i + '</td>' + $trr);
                         ITDiv.append($tr);
                     } else {

                     }
                     for (var j = 0; j < $rowsit; j++) {
                        
                         var $trr = '';
                         if (j === 0) {

                             $trr =
                                 '<tr>' +
                             '<td>1</td>' +
                             '<td>' +
                             '<input value="' + responsedata.locationit[j].id + '"  type="hidden" name="detail_id[]" />' +
                             '<input class="form-control" type="text" placeholder="Location" name="location[]" value="' + responsedata.locationit[j].location + '" required />' +
                             '</td >' +
                                 '<td>' +
                                
                                 '<input class="form-control" type="text" placeholder="Location of Cylinder" name="locationcylinder[]" value="' + responsedata.locationit[j].locationCylinder + '" required />' +
                                 '</td >' +
                                 '<td>' +
                                    '<input class="form-control" type="text" placeholder="Area of Extinguishing System" name="area[]" value="' + responsedata.locationit[j].area + '" required />'+
                                 '</td> ' +
                                 '<td>' +
                                     '<div class="row">' +
                                         '<div class="col-md-12">' +
                                         '<button class="addIT btn btn-default " type="button"><i class="fa fa-plus"></i></button>&nbsp;' +
                                         '<button class="detailIT btn btn-info " type="button"  data-location="' + responsedata.locationit[j].area +'" data-id=' + responsedata.locationit[j].id + ' ><i class="fa fa-list"></i></button>' +
                                         '</div>' +
                                     '</div>' +
                                 '</td > ' +
                                 '</tr>'


                         } else {
                           
                             var i = $('#p_IT tr').length + 1;

                             $trr =

                                 '<td>' +
                                 '<input value="' + responsedata.locationit[j].id + '"  type="hidden" name="detail_id[]" />' +
                                 '<input class="form-control" type="text" placeholder="Location" name="location[]" value="' + responsedata.locationit[j].location + '" required />' +
                                 '</td >' +
                                 '<td>' +
                                 
                             '<input class="form-control" type="text" placeholder="Location of Cylinder" name="locationcylinder[]" value="' + responsedata.locationit[j].locationCylinder + '" required />' +
                                 '</td >' +
                                 '<td>' +
                                 '<input class="form-control" type="text" placeholder="Area of Extinguishing System" name="area[]" value="' + responsedata.locationit[j].area + '" required />'+
                             '</td> ' +
                             '<td>' +
                                 '<a class="remIT btn btn-danger"><span title="Delete" class="glyphicon glyphicon-remove"></span></a>&nbsp;' +
                                 '<button class="detailIT btn btn-info " type="button"  data-location="' + responsedata.locationit[j].area +'" data-id=' + responsedata.locationit[j].id + '><i class="fa fa-list"></i></button>' +
                                 '</td>'

                         }
                         var $tr = $('<tr>').append('<td>' + i + '</td>' + $trr);
                         ITDiv.append($tr);



                     }



                 } else {

                    toastr["error"](responsedata.message)
                    toastr.options = {
                        "closeButton": true,
                        "showDuration": "3000",
                    }
                }
            }
        })
    }
    function showItemModal($type, $refid, $location) {
        EquipmentType = $type;
        ReferenceId = $refid;
        reloadtable($type, $refid);
        $("#modalTitle").html('Items');
        $("#ItemType").val($type);
        $("#ReferenceId").val($refid);
        $("#LocationName").val($location);
        $("#modalItem").modal("show");

    }
    function reloadtable($type,$refid) {

       var data = [];

        $.ajax({
            url: "@Url.Action("getDataItems", "Items")"
            , method: "POST"
            , dataType: 'json'
            , data: { type: $type, refid: $refid}
            , success: function (responsedata) {
                

                                if (responsedata.status == "success") {


                                    for (var i = 0; i < responsedata.data.length; i++) {

                                        var $id = responsedata.data[i].id;
                                       

                                        $actions =
                                            //'<a title="Edit" class="btn btn-white btn-bitbucket" href="' + linkEdit + '"><i class="fa fa-wrench"></i></a> ' +
                                            //'<a title="Details" class="btn btn-info btn-bitbucket" href="' + linkDetails + '"><i class="fa fa-list"></i></a> ';
                                            '<a title="Delete" class="btn btn-danger btn-bitbucket" onclick="deleteItem(' + $id + ')"><i class="fa fa-trash"></i></a>';
                                        data.push([
                                              responsedata.data[i].code
                                            , responsedata.data[i].name
                                            , responsedata.data[i].serialNo
                                            , responsedata.data[i].itemStatus
                                            , $actions]
                                        );

                                    }


                                    if ($.fn.DataTable.isDataTable('#tblItems')) {
                                        $('#tblItems').DataTable().destroy();

                                    }



                                    $('#tblItems').DataTable({
                                        "data": data,
                                        "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                                        "columnDefs": [
                                            {
                                                'targets': 0,
                                                'orderable' : false,
                                                'checkboxes': {
                                                    'selectRow': true
                                                }
                                            },
                                             {
                                                'targets': 1,
                                                'orderable': false
                                            }
                                            //{ className: "td-actions text-right", targets: 1}
                                        ],
                                        'select': {
                                            'style': 'multi'
                                        },
                                        order: [1, 'asc'],
                                    });

                                   

                                  



                                } else {
                                    toastr["error"](responsedata.message)
                                    toastr.options = {
                                        "closeButton": true,
                                        "showDuration": "3000",
                                    }
                                }

            }
        })




    }
    function reloadItems() {
        $("#modalTitleItems").html('Item List');
       var data = [];

         $.ajax({
                        url: "@Url.Action("getItems", "Items")"
                            , method: "POST"
                            , dataType: 'json'
             , data: { equipment: $("#ItemType").val()}
                            , success: function (responsedata) {
                                console.log(responsedata);
                                if (responsedata.status == "success") {


                                    for (var i = 0; i < responsedata.data.length; i++) {

                                        var $id = responsedata.data[i].id;

                                        data.push([
                                            '<input type="checkbox" name="id[]" value="' + $id + '">'
                                            , responsedata.data[i].code
                                            , responsedata.data[i].name 
                                            , responsedata.data[i].serialNo 
                                            , responsedata.data[i].equipmentType 
                                            , responsedata.data[i].itemStatus 
                                            ]);

                                    }
                                    if ($.fn.DataTable.isDataTable('#tblItemsList')) {
                                        $('#tblItemsList').DataTable().destroy();

                                    }
                                    $('#tblItemsList').DataTable({
                                        "data" : data,
                                        "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                                        "columnDefs": [
                                           
                                        ],
                                    });

                                    //$("#modalItemList").modal("show");
                                } else {
                                   swal("Error!" + responsedata.message, "Please try again", "error");
                                }

                            }
        });




    }
    $('#tblItemsList-select-all').on('click', function () {
        table = $('#tblItemsList').DataTable();
        // Check/uncheck all checkboxes in the table
        var rows = table.rows({ 'search': 'applied' }).nodes();
        $('input[type="checkbox"]', rows).prop('checked', this.checked);



    });
    // Handle click on checkbox to set state of "Select all" control
    $('#tblItemsList tbody').on('change', 'input[type="checkbox"]', function () {
        // If checkbox is not checked
        if (!this.checked) {
            var el = $('#tblItemsList-select-all').get(0);
            // If "Select all" control is checked and has 'indeterminate' property
            if (el && el.checked && ('indeterminate' in el)) {
                // Set visual state of "Select all" control
                // as 'indeterminate'
                el.indeterminate = true;
            }
        }

    });
    function proceed() {
                var arr = [];
                table = $('#tblItemsList').DataTable();
                table.$('input[type="checkbox"]').each(function () {
                    if (this.checked) {
                        arr.push({ Equipment: $("#ItemType").val(), HeaderId: $("#ReferenceId").val(),ItemId: this.value });
                    }
                })
               
                if (arr.length < 1) {
                    alert("No record found");
                    
                } else {

                    $str = JSON.stringify(arr);
                    
                
                    console.log($str);
                    $.ajax({
                        url: "@Url.Action("SaveItemLocation", "Items")"
                        , method: "POST"
                        , data: { list: arr,LocationName:$("#LocationName").val() }
                        , dataType: 'json'
                        , async: false
                        , success: function (responsedata) {
                            if (responsedata.status == "success") {

                                toastr["success"]("Item added", "<b>Success</b> ")

                           
                                $("#modalItemList").modal("hide");
                                
                                reloadtable(EquipmentType, ReferenceId)
                                $("#modalItem").modal("show");


                            } else {

                                toastr["error"](responsedata.message)
                                toastr.options = {
                                    "closeButton": true,
                                    "showDuration": "3000",
                                }
                            }
                        }
                    })
                }

    }
    $("#closeItem").click(function () {
        $('#modalItem').modal("hide");


    })
    $("#closeItemList").click(function () {
        $('#modalItemList').modal("hide");
        reloadtable(EquipmentType, ReferenceId)
        $("#modalItem").modal("show");
        
    })
     function deleteItem(id) {
         if (confirm('This will delete list. Continue?')) {
            $.ajax({
            url: "@Url.Action("DeleteItem", "Items")"
            , method: "POST"
                , data: { id: id, LocationName: $("#LocationName").val() }
            , dataType: 'json'
            , success: function (responsedata) {
               if (responsedata.status == "success") {

                   toastr["success"]("Item Deleted","<b>Success</b> ")

                   reloadtable(EquipmentType, ReferenceId)
                  


                } else {

                    toastr["error"](responsedata.message)
                    toastr.options = {
                        "closeButton": true,
                        "showDuration": "3000",
                    }
                }
            }
        })

        }
    }
</script>



